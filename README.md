# Schedular Bot

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏, –±—ã—Å—Ç—Ä—ã–º –≤–µ–±-–ø–æ–∏—Å–∫–æ–º –∏ –ø–æ–≥–æ–¥–æ–π –ø–æ –≥–æ—Ä–æ–¥—É.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏**
  - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –¥–∞—Ç–æ–π/–≤—Ä–µ–º–µ–Ω–µ–º;
  - –ø—Ä–æ—Å–º–æ—Ç—Ä –±–ª–∏–∂–∞–π—à–µ–π –∑–∞–¥–∞—á–∏;
  - –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á;
  - –ø–µ—Ä–µ–Ω–æ—Å –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–¥–∞—á–∏;
  - –æ—Ç–º–µ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π.
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**
  - –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `job_queue`;
  - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ pending-–∑–∞–¥–∞—á –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –±–æ—Ç–∞.
- **–ü–æ–≥–æ–¥–∞**
  - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ `wttr.in` (–±–µ–∑ API-–∫–ª—é—á–∞);
  - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î;
  - –ø–µ—Ä–µ–≤–æ–¥ –ø–æ–≥–æ–¥–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–∏–π.
- **–ü–æ–∏—Å–∫**
  - –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ DuckDuckGo (`ddgs`) –ø—Ä—è–º–æ –∏–∑ –±–æ—Ç–∞.
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
  - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ;
  - –±–∞–∑–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (`pytest`, `pytest-asyncio`, `pytest-cov`).

---

## üß± –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.11+**
- **python-telegram-bot 22.x**
- **PostgreSQL**
- **asyncpg**
- **aiohttp**
- **DDGS (DuckDuckGo Search)**
- **pytest / pytest-asyncio / pytest-cov**

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
schedular_bot/
‚îú‚îÄ‚îÄ app/                # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –ª–æ–≥–≥–µ—Ä, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ bot/                # –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ constants/          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –ø–æ–≥–æ–¥—ã
‚îú‚îÄ‚îÄ handlers/           # –•–µ–Ω–¥–ª–µ—Ä—ã –∫–æ–º–∞–Ω–¥, callback-–æ–≤ –∏ –¥–∏–∞–ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–∑–∞–¥–∞—á–∏, –ø–æ–∏—Å–∫, –ø–æ–≥–æ–¥–∞)
‚îú‚îÄ‚îÄ utils/              # –í–∞–ª–∏–¥–∞—Ü–∏—è/–ø–∞—Ä—Å–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ database.py         # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îú‚îÄ‚îÄ keyboard.py         # –ò–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ states.py           # –°–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Procfile            # –ö–æ–Ω—Ñ–∏–≥ –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ pytest.ini
```

---

## ‚öôÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1) –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
git clone <your_repo_url>
cd schedular_bot
```

### 2) –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# .venv\Scripts\activate   # Windows (PowerShell)
```

### 3) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
TELEGRAM_TOKEN=your_telegram_token_here
DATABASE_URL=postgresql://user:password@host:port/dbname
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env.example` –∫–∞–∫ —à–∞–±–ª–æ–Ω.

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```bash
python -m app.main
```

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç:

1. –∑–∞–≥—Ä—É–∂–∞–µ—Ç `.env`;
2. –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å PostgreSQL;
3. –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á;
4. –Ω–∞—á–∏–Ω–∞–µ—Ç polling Telegram API.

---

## üß† –õ–æ–≥–∏–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É¬ª.
2. –í–≤–æ–¥–∏—Ç –¥–∞—Ç—É/–≤—Ä–µ–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2026-02-10 18:30`, `—Å–µ–≥–æ–¥–Ω—è 21:00`, `–∑–∞–≤—Ç—Ä–∞ 9:00`).
3. –í–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏.
4. –ó–∞–¥–∞—á–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`.
5. –í `job_queue` —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è

- –ü–æ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∑–∞–¥–∞—á–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏:
  - ¬´‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞¬ª
  - ¬´‚è∞ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏¬ª
  - ¬´‚Ü©Ô∏è –í –º–µ–Ω—é¬ª
- –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –±–æ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –ë–î (–∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç–∞—Ç—É—Å).

### –ü–æ–≥–æ–¥–∞

- –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –≥–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î.
- –ï—Å–ª–∏ –≥–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω ‚Äî —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≥–æ–¥—É.
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.

### –ü–æ–∏—Å–∫

- –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è.
- –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ DuckDuckGo.
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `title + link`.

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –ë–î

–°–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã:

- `tasks`
  - `id TEXT PRIMARY KEY`
  - `user_id BIGINT NOT NULL`
  - `title TEXT NOT NULL`
  - `scheduled_time TIMESTAMPTZ NOT NULL`
  - `status TEXT NOT NULL` (`pending` / `done`)
- `users`
  - `user_id BIGINT PRIMARY KEY`
  - `city TEXT`

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
pytest
```

–ü–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è –º–æ–¥—É–ª–∏:

- `utils`
- `services`
- `handlers/common`

–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –æ—Ç—á—ë—Ç—ã coverage (–≤ –∫–æ–Ω—Å–æ–ª—å –∏ `coverage.xml`).

---

## üì¶ –î–µ–ø–ª–æ–π

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å `Procfile`:

```procfile
bot: python -m app.main
```

–≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –¥–µ–ø–ª–æ–π –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö —Ç–∏–ø–∞ Railway/Heroku-–ø–æ–¥–æ–±–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üõ†Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –¥–∞–ª—å—à–µ

- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–∞–π–º–∑–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–µ–π—á–∞—Å –ª–æ–≥–∏–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –ú–°–ö(UTC+3)).
- –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è callback-—Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ job queue.
- –î–æ–±–∞–≤–∏—Ç—å Dockerfile.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
