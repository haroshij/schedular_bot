from telegram import InlineKeyboardButton, InlineKeyboardMarkup
from utils.tasks_utils import format_task_date
from constants.keyboard_constants import MAX_TASK_LENGTH

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞
# MAIN_MENU ‚Äî —ç—Ç–æ InlineKeyboardMarkup, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞:
# - –ö–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ –∏–º–µ–µ—Ç —Ç–µ–∫—Å—Ç –∏ callback_data, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ callback_query
# - –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä—è–¥–∞—Ö (—Å–ø–∏—Å–∫–∞—Ö)
MAIN_MENU = InlineKeyboardMarkup(
    [
        [InlineKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É", callback_data="add_task")],
        [InlineKeyboardButton("‚è≥ –ë–ª–∏–∂–∞–π—à–∞—è –∑–∞–¥–∞—á–∞", callback_data="nearest_task")],
        [InlineKeyboardButton("üìã –í—Å–µ –∑–∞–¥–∞—á–∏", callback_data="all_tasks")],
        [InlineKeyboardButton("üîé –ü–æ–∏—Å–∫", callback_data="search")],
        [InlineKeyboardButton("üå§ –ü–æ–≥–æ–¥–∞", callback_data="weather")],
    ]
)


# –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–µ–π
def task_actions(task_id: str) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏.

    –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫–∏:
    - "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" ‚Äî –æ—Ç–º–µ—á–∞–µ—Ç –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
    - "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏" ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–¥–∞—á–∏
    - "–í –º–µ–Ω—é" ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

    –ö–∞–∂–¥—ã–π callback_data —Å–æ–¥–µ—Ä–∂–∏—Ç task_id –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∏.

    –®–∞–≥–∏:
    1. –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (–∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ ‚Äî InlineKeyboardButton)
    2. –§–æ—Ä–º–∏—Ä—É–µ–º callback_data —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–¥–∞—á–∏
    3. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –≤ InlineKeyboardMarkup –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º

    Args:
        task_id (str): –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏

    Returns:
        InlineKeyboardMarkup: Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –¥–ª—è –∑–∞–¥–∞—á–∏
    """
    kb = [
        [InlineKeyboardButton("‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞", callback_data=f"done:{task_id}")],
        [InlineKeyboardButton("‚è∞ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏", callback_data=f"postpone:{task_id}")],
        [InlineKeyboardButton("‚Ü©Ô∏è –í –º–µ–Ω—é", callback_data="menu")],
    ]
    return InlineKeyboardMarkup(kb)


# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –∑–∞–¥–∞—á
def tasks_inline_menu(tasks: list) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞:
    - –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–µ—Å–ª–∏ –±–æ–ª—å—à–µ 19 —Å–∏–º–≤–æ–ª–æ–≤)
      –∏ –¥–∞—Ç—É/–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—á–µ—Ä–µ–∑ format_task_date)
    - callback_data —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞

    –®–∞–≥–∏:
    1. –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ kb –¥–ª—è –∫–Ω–æ–ø–æ–∫
    2. –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:
       - –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
       - –ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–µ, –æ–±—Ä–µ–∑–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º "..."
       - –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º
       - –î–æ–±–∞–≤–ª—è–µ–º InlineKeyboardButton –≤ —Å–ø–∏—Å–æ–∫ kb
    3. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –≤ InlineKeyboardMarkup –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º

    Args:
        tasks (list): –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∑–∞–¥–∞—á–∞–º–∏, –≥–¥–µ –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞
                      —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫ –º–∏–Ω–∏–º—É–º –ø–æ–ª—è 'id', 'title', 'scheduled_time'

    Returns:
        InlineKeyboardMarkup: Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –∑–∞–¥–∞—á
    """
    kb = []
    for t in tasks:
        if len(t["title"]) > MAX_TASK_LENGTH:
            title = f"{t['title'][:MAX_TASK_LENGTH]}..."
        else:
            title = t["title"]
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º –∑–∞–¥–∞—á–∏
        text = f"  {title}   ‚è∞ {format_task_date(t['scheduled_time'])}  "
        kb.append([InlineKeyboardButton(text, callback_data=f"task:{t['id']}")])
    return InlineKeyboardMarkup(kb)


# –ú–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –ø–æ–≥–æ–¥—ã
def weather_actions_kb() -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –≤ —Ä–∞–∑–¥–µ–ª–µ –ø–æ–≥–æ–¥—ã.

    –ö–Ω–æ–ø–∫–∏:
    - "–î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥" ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
    - "–í –º–µ–Ω—é" ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

    –®–∞–≥–∏:
    1. –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ (–∫–∞–∂–¥–∞—è –∫–Ω–æ–ø–∫–∞ ‚Äî InlineKeyboardButton)
    2. –£–∫–∞–∑—ã–≤–∞–µ–º callback_data –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è
    3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏

    Args:
        -

    Returns:
        InlineKeyboardMarkup: Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–≥–æ–¥–æ–π
    """
    return InlineKeyboardMarkup(
        [
            [InlineKeyboardButton("üîÑ –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥", callback_data="weather_change")],
            [InlineKeyboardButton("‚Ü©Ô∏è –í –º–µ–Ω—é", callback_data="menu")],
        ]
    )
