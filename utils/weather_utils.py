import re

from constants.weather_constants import WEATHER_TRANSLATIONS

"""
Вспомогательный модуль для работы с погодными данными.

Модуль содержит функции, которые используются при обработке
погодной информации:
- валидация названия города, введённого пользователем;
- перевод текстового описания погоды с английского языка на русский.
"""

# Регулярное выражение для проверки корректности названия города
# Разрешены:
# - латинские и кириллические буквы,
# - пробелы и дефисы,
# - длина строки от 2 до 50 символов
CITY_RE = re.compile(r"^[A-Za-zА-Яа-яЁё \-]{2,50}$")


def validate_city(city: str) -> bool:
    """
    Проверяет корректность названия города, введённого пользователем.

    Функция используется перед выполнением запроса к погодному сервису
    для предотвращения:
    - некорректных HTTP-запросов;
    - бессмысленных обращений.

    Валидация выполняется с помощью регулярного выражения и проверяет,
    что строка:
    - содержит только допустимые символы;
    - имеет разумную длину.

    Args:
        city (str): Название города, введённое пользователем.

    Returns:
        bool: True, если название города прошло валидацию,
        False, если строка не соответствует допустимому формату.
    """
    # Проверяем строку на соответствие регулярному выражению
    return bool(CITY_RE.match(city))


def translate_weather(desc: str) -> str:
    """
    Переводит английское описание погоды на русский язык, если перевод доступен.

    Функция использует словарь WEATHER_TRANSLATIONS, в котором
    хранятся сопоставления английских описаний погоды с русскими.

    Если описание погоды отсутствует в словаре:
    - возвращается исходное описание (с приведением регистра).

    Args:
        desc (str): Описание погоды на английском языке,
                    полученное от внешнего погодного сервиса.

    Returns:
        str: Переведённое описание погоды на русском языке,
             либо оригинальное описание, если перевод не найден.
    """
    # Приводим описание к формату с заглавной буквы для корректного поиска в словаре
    desc = desc.capitalize()

    # Пытаемся получить перевод из словаря, иначе возвращаем исходное описание
    return WEATHER_TRANSLATIONS.get(desc, desc)
